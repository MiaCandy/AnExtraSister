<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>歌词滚动</title>
		<!--屏幕自适应-->
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=2.0, user-scalable=yes" />
		
		<!--页面样式-->
		<link rel="stylesheet" href="css/hovertree.css" />
		<!--歌词样式-->
		<link type="text/css" rel="stylesheet" href="css/musicplay.css"  />
		
		<script type="text/javascript" src="js/jquery-1.9.1.min.js" ></script>
		<script src="js/getLyric.js" type="text/javascript"></script>
		<script type="text/javascript" src="js/myStyle.js" ></script>
	</head>
	<body>

		<!--页面标题-->
		<div class="hovertreeinfo">
			<h2>只属于你</h2>
		</div>
		<!--image外层容器-->
		<div class="wrap">
			<!--	/*包裹所有元素的容器*/-->
			<div class="cube">
				<!--前面图片 -->
				<div class="out_front">
					<img src="img/01.jpg " class="pic" />
				</div>
				<!--后面图片 -->
				<div class="out_back">
					<img src="img/02.jpg" class="pic"/>
				</div>
				<!--左图片 -->
				<div class="out_left">
					<img src="img/03.jpg" class="pic" />
				</div>
				<div class="out_right">
					<img src="img/04.jpg" class="pic" />
				</div>
				<div class="out_top">
					<img src="img/05.jpg" class="pic" />
				</div>
				<div class="out_bottom">
					<img src="img/06.jpg" class="pic" />
				</div>
				<!--小正方体 -->
				<span class="in_front">
					<img src="img/07.jpg" class="in_pic" />
				</span>
				<span class="in_back">
					<img src="img/08.jpg" class="in_pic" />
				</span>
				<span class="in_left">
					<img src="img/09.jpg" class="in_pic" />
				</span>
				<span class="in_right">
					<img src="img/10.jpg" class="in_pic" />
				</span>
				<span class="in_top">
					<img src="img/11.jpg" class="in_pic" />
				</span>
				<span class="in_bottom">
					<img src="img/12.jpg" class="in_pic" />
				</span>
			</div>
		</div>
		
		
		
		<!-- 歌词显示盒子 -->
		<div class="bg"></div>
		
		<!-- 这里修改播放器播放音乐 -->
		<!-- 隐藏播放条：删除ontrols="controls"部分-->
		<audio autoplay="autopaly" loop="loop" controls="controls" id="audios" style="margin-left: 0; width: 400px;">
			<source src="music/yz.mp3" type="audio/mp3" />
		</audio>
		
		
		<!-- 网易云外链音乐 -->
		<!-- 只有发布和编译到端口才会自动播放  找到歌曲id也可以发布成功-->
		<!-- <div style="position:absolute;right:0px;bottom:0px;">
			<iframe frameborder="no" border="0" marginwidth="0" marginheight="100%" width=330 height=86 
				src="//music.163.com/outchain/player?type=2&id=27511298&auto=1&height=66"></iframe>
		</div> -->

	</body>
	
	 <script type="text/javascript">
	 	$(function() {
		 		function parseLyric(text) {
	            //按行分割歌词
	            let lyricArr = text.split('\n');
	            //console.log(lyricArr)//0: "[ti:七里香]" "[ar:周杰伦]"...
	            let result = []; //新建一个数组存放最后结果
	            //遍历分割后的歌词数组，将格式化后的时间节点，歌词填充到result数组
	            for (i = 0; i < lyricArr.length; i++) {
	                let playTimeArr = lyricArr[i].match(/\[\d{2}:\d{2}((\.|\:)\d{2})\]/g); //正则匹配播放时间
	                let lineLyric = "";
	                if (lyricArr[i].split(playTimeArr).length > 0) {
	                    lineLyric = lyricArr[i].split(playTimeArr);
	                }
	
	                if (playTimeArr != null) {
	                    for (let j = 0; j < playTimeArr.length; j++) {
	                        let time = playTimeArr[j].substring(1, playTimeArr[j].indexOf("]")).split(":");
	                        //数组填充
	                        result.push({
	                            time: (parseInt(time[0]) * 60 + parseFloat(time[1])).toFixed(4),
	                            content: String(lineLyric).substr(1)
	                        });
	                    }
	                }
	
	
	            }
	            return result;
	        }
		 		
		 		
	        //使用js去获取歌曲lrc歌词
			let text = "[00:00.00]这世界有那么多人\n[00:01.00]来自忙碌的方哥\n[00:02.00]For柚子:月亮不上班\n[00:03.00]我来道晚安\n[00:18.75]这世界有那么多人\n[00:25.19]     人群里 敞着一扇门\n[00:31.19]     我迷朦的眼睛里长存\n[00:38.00]     初见你  蓝色清晨\n[00:45.17]这世界有那么多人\n[00:50.98]     多幸运 我有个我们\n[00:57.97]     这悠长命运中的晨昏\n[01:04.59]     常让我 望远方出神\n[01:12.25]灰树叶飘转在池塘\n[01:18.17]  看飞机轰的一声去远乡\n[01:24.68]   光阴的长廊 脚步声叫嚷\n[01:31.23]   灯一亮 无人的空荡\n[01:39.02]晚风中闪过 几帧从前啊\n[01:45.06]  飞驰中旋转 已不见了吗\n[01:52.09]   远光中走来 你一身晴朗\n[01:59.08]   身旁那么多人 可世界不声 不响\n[02:11.84]这世界有那么多人\n[02:18.70]    多幸运 我有个我们\n[02:25.06]    这悠长命运中的晨昏\n[02:31.28]    常让我 望远方出神\n[02:38.90]灰树叶飘转在池塘\n[02:45.32]   看飞机轰的一声去远乡\n[02:51.28]   光阴的长廊 脚步声叫嚷\n[02:57.93]   灯一亮 无人的空荡\n[03:05.40]晚风中闪过 几帧从前啊\n[03:12.19] 飞驰中旋转 已不见了吗\n[03:18.44]  远光中走来 你一身晴朗\n[03:25.53]  身旁那么多人 可世界不声 不响\n[03:35.62]笑声中浮过 几张旧模样\n[03:41.80]   留在梦田里 永远不散场\n[03:48.48]   暖光中醒来 好多话要讲\n[03:55.74]   世界那么多人 可是它不声 不响\n[04:07.89] 这世界有那么个人\n[04:14.34]      活在我 飞扬的青春\n[04:21.43]     在泪水里浸湿过的长吻\n[04:27.96]     常让我 想啊想出神\n[04:38.84]Strings所有弦乐器 		彭飞\n[04:39.39]Guitar吉他 			胡洋\n[04:39.87]Mandolin曼陀林		彭飞\n[04:40.31]Drums鼓 			荒井十一\n[04:40.98]Recording Studio录音室 	Studio 21A\n[04:41.35]Recorded by 录音师		倪韩文\n[04:41.74]Mixing Studio 混音室		Studio 21A\n[04:42.10]Mixed by 混音师		周天澈\n[04:42.47]Master Engineer 母带工程师	周天澈\n";
		
			
	        let audio = document.querySelector('audio');
			//执行lyc解析
	        let result = parseLyric(text); 
	
	
	        // 把生成的数据显示到界面上去
	        let $ul = $("<ul></ul>");
	        for (let i = 0; i < result.length; i++) {
	            let $li = $("<li></li>").text(result[i].content);
	            $ul.append($li);
	        }
	        $(".bg").append($ul);
			// 当前行歌词
	        let lineNo = 0; 
			// 当播放6行后开始滚动歌词
	        let preLine =1; 
			// 每次滚动的距离
	        let lineHeight = -30; 
	
	        // 滚动播放 歌词高亮  增加类名active
	        function highLight() {
	            let $li = $("li");
	            $li.eq(lineNo).addClass("active").siblings().removeClass("active");
	            if (lineNo > preLine) {
	                $ul.stop(true, true).animate({ top: (lineNo - preLine) * lineHeight });
	            }
	        }
	
	        highLight();
	
	        // 播放的时候不断渲染
	        audio.addEventListener("timeupdate", function() {
	            if (lineNo == result.length) return;
	            if ($("li").eq(0).hasClass("active")) {
	                $("ul").css("top", "0");
	            }
	            lineNo =getLineNo(audio.currentTime);
	            highLight();
	            lineNo++;
	        });
	
	        // 当快进或者倒退的时候，找到最近的后面那个result[i].time
	        function getLineNo(currentTime) {
	            if (currentTime >= parseFloat(result[lineNo].time)) {
	                // 快进
	                for (let i = result.length - 1; i >= lineNo; i--) {
	                    if (currentTime >= parseFloat(result[i].time)) {
	                        return i;
	                    }
	                }
	            } else {
	                // 后退
	                for (let i = 0; i <= lineNo; i++) {
	                    if (currentTime <= parseFloat(result[i].time)) {
	                        return i - 1;
	                    }
	                }
	            }
	        }
	
	        //播放结束自动回到开头
	        audio.addEventListener("ended", function() {
	            lineNo = 0;
	            highLight();
	            audio.play();
	            $("ul").css("top", "0");
	        });
	 	});
    </script>
</html>
